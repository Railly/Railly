---
import CrafterIcon from "../../assets/svgs/crafter.svg";
import ViewCounter from "../blog/ViewCounter";
import ClerkLogo from "../brand/ClerkLogo.astro";
import Card from "./Card.astro";

type ColorName =
	| "blue"
	| "teal"
	| "yellow"
	| "cyan"
	| "purple"
	| "magenta"
	| "orange";

interface Props {
	title: string;
	description?: string;
	color: ColorName;
	href?: string;
	target?: "_blank" | "_self";
	className?: string;
	image?: string;
	imageDark?: string;
	date?: string;
	tag?: string;
	slug?: string;
}

const {
	title,
	description,
	color,
	href,
	target = "_self",
	className,
	image,
	imageDark,
	date,
	tag,
	slug,
} = Astro.props;
---

<Card
    href={href}
    target={target}
    color={color}
    className={className}
    padding="p-2"
>
    {
        image && (
            <div class="relative w-full aspect-video overflow-hidden rounded-lg mb-2 flex items-center justify-center bg-flexoki-bg-2">
                <img
                    src={image}
                    alt={title}
                    class={`object-contain block dark:hidden ${imageDark ? "max-w-[85%] max-h-[85%]" : "max-w-[60%] max-h-[60%]"}`}
                    loading="lazy"
                />
                {imageDark && (
                    <img
                        src={imageDark}
                        alt={title}
                        class="max-w-[85%] max-h-[85%] object-contain hidden dark:block"
                        loading="lazy"
                    />
                )}
                {!imageDark && (
                    <img
                        src={image}
                        alt={title}
                        class="max-w-[60%] max-h-[60%] object-contain hidden dark:block"
                        loading="lazy"
                    />
                )}
                <div class="absolute inset-0 border border-flexoki-ui-2 rounded-lg pointer-events-none" />
            </div>
        )
    }
    <div class={`relative z-10 ${image ? "p-1.5" : ""}`}>
        <div class="mb-1">
            <h3
                class={`font-serif text-flexoki-tx group-hover:text-flexoki-${color} transition-colors font-medium`}
            >
                {title}
            </h3>
        </div>
        {
            description && (
                <p class="text-sm text-flexoki-tx-2 mt-1">{description}</p>
            )
        }
        {
            date && (
                <div class="flex items-center justify-between gap-2 text-sm text-flexoki-tx-3 !my-0 !mt-3">
                    <div class="flex items-center gap-2">
                        <span>{date}</span>
                        {tag &&
                            (tag === "math" ||
                                tag === "midudev" ||
                                tag === "clerk" ||
                                tag === "crafter-station" ||
                                tag === "unmsm") && (
                                <>
                                    <span class="text-flexoki-tx-3">Â·</span>
                                    <div class="flex items-center justify-center size-4">
                                        {tag === "math" && (
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                width="24"
                                                height="24"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                class={`stroke-flexoki-tx-3 size-4`}
                                            >
                                                <path d="M18 7V4H6l6 8-6 8h12v-3" />
                                            </svg>
                                        )}
                                        {tag === "midudev" && (
                                            <img
                                                src="/images/midudev-logo.webp"
                                                alt="Midudev"
                                                class="size-4"
                                            />
                                        )}
                                        {tag === "clerk" && (
                                            <ClerkLogo width={16} height={16} />
                                        )}
                                        {tag === "crafter-station" && (
                                            <CrafterIcon class="size-4" />
                                        )}
                                        {tag === "unmsm" && (
                                            <img
                                                src="/images/unmsm-logo.webp"
                                                alt="UNMSM"
                                                class="size-4"
                                            />
                                        )}
                                    </div>
                                </>
                            )}
                    </div>
                    {slug && (
                        <ViewCounter
                            slug={slug}
                            client:only="react"
                            className="text-xs text-flexoki-tx-3"
                        />
                    )}
                </div>
            )
        }
    </div>
    {
        !image && (
            <div
                class={`absolute inset-0 bg-gradient-to-tr from-flexoki-${color}/[0.03] to-transparent opacity-80 [mask-image:linear-gradient(45deg,#000_25%,transparent_25%,transparent_50%,#000_50%,#000_75%,transparent_75%,transparent)] [mask-size:8px_8px] pointer-events-none`}
            />
        )
    }
</Card>
