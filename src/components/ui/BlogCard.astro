---
import Card from "./Card.astro";
import ClerkLogo from "../brand/ClerkLogo.astro";
import CrafterIcon from "../../assets/svgs/crafter.svg";
import ViewCounter from "../blog/ViewCounter";

type ColorName =
    | "blue"
    | "teal"
    | "yellow"
    | "cyan"
    | "purple"
    | "magenta"
    | "orange";

interface Props {
    title: string;
    description?: string;
    color: ColorName;
    href?: string;
    target?: "_blank" | "_self";
    className?: string;
    image?: string;
    imageDark?: string;
    date?: string;
    tag?: string;
    slug?: string;
}

const {
    title,
    description,
    color,
    href,
    target = "_self",
    className,
    image,
    imageDark,
    date,
    tag,
    slug,
} = Astro.props;
---

<Card
    href={href}
    target={target}
    color={color}
    className={className}
    padding="p-2"
>
    {
        image && (
            <div class="relative w-full aspect-video overflow-hidden rounded-lg mb-2 flex items-center justify-center bg-flexoki-bg-2">
                <img
                    src={image}
                    alt={title}
                    class="max-w-[60%] max-h-[60%] object-contain block dark:hidden"
                    loading="lazy"
                />
                {imageDark && (
                    <img
                        src={imageDark}
                        alt={title}
                        class="max-w-[60%] max-h-[60%] object-contain hidden dark:block"
                        loading="lazy"
                    />
                )}
                {!imageDark && (
                    <img
                        src={image}
                        alt={title}
                        class="max-w-[60%] max-h-[60%] object-contain hidden dark:block"
                        loading="lazy"
                    />
                )}
                <div class="absolute inset-0 border border-flexoki-ui-2 rounded-lg pointer-events-none" />
            </div>
        )
    }
    <div class={`relative z-10 ${image ? "p-2" : ""}`}>
        <div class="flex items-center gap-2 mb-1">
            <h3
                class={`font-serif text-flexoki-tx group-hover:text-flexoki-${color} transition-colors font-medium flex-1`}
            >
                {title}
            </h3>
            {
                tag && (
                    <div
                        class={`flex items-center justify-center size-6 shrink-0`}
                    >
                        {tag === "math" && (
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                class={`fill-flexoki-tx-3 size-5`}
                            >
                                <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M3.5 5.5C3.5 3.84315 4.84315 2.5 6.5 2.5H17.5C19.1569 2.5 20.5 3.84315 20.5 5.5V18.5C20.5 20.1569 19.1569 21.5 17.5 21.5H6.5C4.84315 21.5 3.5 20.1569 3.5 18.5V5.5ZM8 8C8 7.44772 8.44772 7 9 7H15C15.5523 7 16 7.44772 16 8C16 8.55228 15.5523 9 15 9H9C8.44772 9 8 8.55228 8 8ZM8 12C8 11.4477 8.44772 11 9 11H12C12.5523 11 13 11.4477 13 12C13 12.5523 12.5523 13 12 13H9C8.44772 13 8 12.5523 8 12Z"
                                />
                            </svg>
                        )}
                        {tag === "midudev" && (
                            <img
                                src="/images/midudev-logo.webp"
                                alt="Midudev"
                                class="size-5"
                            />
                        )}
                        {tag === "clerk" && (
                            <ClerkLogo width={20} height={20} />
                        )}
                        {tag === "crafter-station" && (
                            <CrafterIcon class="size-5" />
                        )}
                        {tag === "unmsm" && (
                            <img
                                src="/images/unmsm-logo.webp"
                                alt="UNMSM"
                                class="size-5"
                            />
                        )}
                    </div>
                )
            }
        </div>
        {
            description && (
                <p class="text-sm text-flexoki-tx-2 mt-1">{description}</p>
            )
        }
        {
            date && (
                <div class="flex items-center justify-between gap-2 text-sm text-flexoki-tx-3 !my-0 !mt-3">
                    <span>{date}</span>
                    {slug && (
                        <ViewCounter
                            slug={slug}
                            client:only="react"
                            className="text-xs text-flexoki-tx-3"
                        />
                    )}
                </div>
            )
        }
    </div>
    {
        !image && (
            <div
                class={`absolute inset-0 bg-gradient-to-tr from-flexoki-${color}/[0.03] to-transparent opacity-80 [mask-image:linear-gradient(45deg,#000_25%,transparent_25%,transparent_50%,#000_50%,#000_75%,transparent_75%,transparent)] [mask-size:8px_8px] pointer-events-none`}
            />
        )
    }
</Card>
