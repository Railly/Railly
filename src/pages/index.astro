---
import { getCollection } from "astro:content";
import Hack0Logo from "../assets/svgs/h0-logo.svg";
import Text0Logo from "../assets/svgs/t0-logo.svg";
import ChileFlag from "../components/brand/ChileFlag.astro";
import ColombiaFlag from "../components/brand/ColombiaFlag.astro";
import ElementsLogo from "../components/brand/ElementsLogo.astro";
import GlobeIcon from "../components/brand/GlobeIcon.astro";
import OneHunterLogo from "../components/brand/OneHunterLogo.astro";
import PeruFlag from "../components/brand/PeruFlag.astro";
import ScrapiLogo from "../components/brand/ScrapiLogo.astro";
import TinteLogo from "../components/brand/TinteLogo.astro";
import Footer from "../components/layout/Footer.astro";
import HeroSection from "../components/layout/HeroSection.astro";
import PageLayout from "../components/layout/PageLayout.astro";
import SectionHeader from "../components/layout/SectionHeader.astro";
import Layout from "../layouts/Layout.astro";

const allPosts = await getCollection("blog", ({ data }) => {
	return import.meta.env.PROD ? data.status !== "draft" : true;
});

const activePosts = allPosts
	.filter(({ data }) => data.status === "published")
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const recentPosts = activePosts.slice(0, 5);

const postsByYear = recentPosts.reduce(
	(acc, post) => {
		const year = post.data.pubDate.getFullYear();
		if (!acc[year]) acc[year] = [];
		acc[year].push(post);
		return acc;
	},
	{} as Record<number, typeof recentPosts>,
);

const years = Object.keys(postsByYear)
	.map(Number)
	.sort((a, b) => b - a);

const newestPost = activePosts[0];
const isNewest = (slug: string) => slug === newestPost?.slug;

const formatDate = (date: Date) => {
	const day = date.getDate().toString().padStart(2, "0");
	const month = (date.getMonth() + 1).toString().padStart(2, "0");
	return `${day}/${month}`;
};

// Data objects for all sections
const heroData = {
	name: "Railly Hugo",
	title: "Hunter",
};

const projectsData = [
	{
		title: "Elements",
		description: "Full-stack shadcn components",
		href: "https://tryelements.dev",
		icon: "elements" as IconKey,
	},
	{
		title: "text0",
		description: "AI-powered text editor",
		href: "https://text0.dev",
		icon: "text0" as IconKey,
	},
	{
		title: "Tinte",
		description: "Multiplatform theme builder",
		href: "https://tinte.dev",
		icon: "tinte" as IconKey,
	},
	{
		title: "One Hunter Theme",
		description: "VS Code theme (35k+ downloads)",
		href: "https://marketplace.visualstudio.com/items?itemName=RaillyHugo.one-hunter",
		icon: "oneHunter" as IconKey,
	},
	{
		title: "Scrapi",
		description: "Fast web scraper",
		href: "https://www.scrapi.fast",
		icon: "scrapi" as IconKey,
	},
	{
		title: "hack0",
		description: "LATAM tech ecosystem map",
		href: "https://hack0.dev",
		icon: "hack0" as IconKey,
	},
];

const achievementsData = [
	{
		year: "2026",
		achievement: "Online Winner",
		event: "Platanus Hack 25'| Voting",
		eventUrl: "https://25.hack.platan.us/vote/scrapifast",
		project: "Scrapi",
		projectUrl: "https://scrapi.fast",
		scope: "cl" as const,
	},
	{
		year: "2025",
		achievement: "Overall Winner",
		event: "Next.js Global Hackathon",
		eventUrl: "https://www.youtube.com/watch?v=KDRwgbwq0_c&t=1142s",
		project: "text0",
		projectUrl: "https://text0.dev",
		scope: "global" as const,
	},
	{
		year: "2025",
		achievement: "1st Place",
		event: "Vercel AI Gateway Hackathon",
		eventUrl: "https://www.youtube.com/watch?v=yKzXoJgPenw&t=28889s",
		project: "Chess Battle",
		projectUrl: "https://github.com/crafter-station/chess-battle",
		scope: "global" as const,
	},
	{
		year: "2025",
		achievement: "Judge & Mentor",
		event: "IA Hackathon Colombia Tech Fest",
		eventUrl:
			"https://www.linkedin.com/posts/railly-hugo_de-vuelta-en-lima-despu%C3%A9s-de-una-experiencia-activity-7369217715481362432-XgLj",
		scope: "co" as const,
	},
	{
		year: "2025",
		achievement: "Outstanding Graduate",
		event: "UNMSM Engineering",
		eventUrl: "https://www.youtube.com/watch?v=swdmucdGGLA&t=10362s",
		scope: "pe" as const,
	},
	{
		year: "2025",
		achievement: "Finalist",
		event: "Platanus Hack 25'",
		eventUrl:
			"https://www.linkedin.com/posts/railly-hugo_gran-experiencia-en-la-platanus-hack-25-activity-7400005671913684992-A1WW",
		project: "Scrapi",
		projectUrl: "https://scrapi.fast",
		scope: "cl" as const,
	},
	{
		year: "2025",
		achievement: "Finalist",
		event: "IA Hackathon LATAM",
		eventUrl:
			"https://www.linkedin.com/feed/update/urn:li:ugcPost:7328521111485243393",
		project: "GitHunter",
		projectUrl: "https://github.com/crafter-station/githunter",
		scope: "global" as const,
	},
	{
		year: "2024",
		achievement: "3rd Place",
		event: "Vercel Ã— Midudev Hackathon",
		eventUrl:
			"https://www.linkedin.com/feed/update/urn:li:ugcPost:7232743944592240640",
		project: "Tinte",
		projectUrl: "https://tinte.dev",
		scope: "global" as const,
	},
];

// Icon mapping for components
const iconMap = {
	elements: ElementsLogo,
	text0: Text0Logo,
	tinte: TinteLogo,
	oneHunter: OneHunterLogo,
	scrapi: ScrapiLogo,
	hack0: Hack0Logo,
} as const;

type IconKey = keyof typeof iconMap;
---

<Layout>
    <PageLayout class="flex flex-col gap-10">
        <HeroSection name={heroData.name} title={heroData.title} />

        <section class="w-full">
            <SectionHeader title="Projects" />
            <div class="space-y-0">
                {
                    projectsData.map((project) => {
                        const IconComponent =
                            project.icon && project.icon in iconMap
                                ? iconMap[project.icon as IconKey]
                                : null;
                        return (
                            <a
                                href={project.href}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="group flex items-center gap-4 py-3 border-b border-flexoki-ui hover:bg-flexoki-bg-2 transition-colors -mx-3 px-3"
                            >
                                <span class="w-6 h-6 flex items-center justify-center shrink-0">
                                    {IconComponent && (
                                        <IconComponent
                                            width={20}
                                            height={20}
                                            class="text-flexoki-tx"
                                        />
                                    )}
                                </span>
                                <span class="flex-1 text-flexoki-tx font-medium">
                                    {project.title}
                                </span>
                                <span class="text-flexoki-tx-3 text-sm hidden sm:block">
                                    {project.description}
                                </span>
                                <svg
                                    width="14"
                                    height="14"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.5"
                                    viewBox="0 0 24 24"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="text-flexoki-tx-3 group-hover:translate-x-0.5 transition-transform shrink-0"
                                >
                                    <path d="M4.5 12h15m0 0-5.625-6m5.625 6-5.625 6" />
                                </svg>
                            </a>
                        );
                    })
                }
            </div>
        </section>
        <section class="w-full">
            <div class="flex items-center justify-between mb-4">
                <SectionHeader title="Writing" className="mb-0" />
                <a
                    href="/writing"
                    class="group text-xs text-flexoki-tx-3 hover:text-flexoki-tx-2 transition-colors duration-200"
                >
                    <span class="flex items-center gap-1">
                        <span>view all</span>
                        <svg
                            width="10"
                            height="10"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="1.5"
                            viewBox="0 0 24 24"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path d="M4.5 12h15m0 0-5.625-6m5.625 6-5.625 6"
                            ></path>
                        </svg>
                    </span>
                </a>
            </div>
            <div class="space-y-0">
                {
                    years.map((year) => (
                        <>
                            {postsByYear[year].map((post, index) => (
                                <a
                                    href={`/blog/${post.slug}`}
                                    class="group flex items-baseline gap-4 py-3 border-b border-flexoki-ui hover:bg-flexoki-bg-2 transition-colors -mx-3 px-3"
                                >
                                    <span class="text-flexoki-tx-3 tabular-nums w-12 shrink-0 text-sm">
                                        {index === 0 ? year : ""}
                                    </span>
                                    <span class="flex-1 text-flexoki-tx group-hover:text-flexoki-tx font-medium text-sm">
                                        {post.data.title}
                                        {isNewest(post.slug) && (
                                            <span class="ml-2 text-xs font-normal px-1.5 py-0.5 bg-flexoki-ui rounded text-flexoki-tx-2">
                                                Newest
                                            </span>
                                        )}
                                    </span>
                                    <span class="text-flexoki-tx-3 tabular-nums text-sm shrink-0">
                                        {formatDate(post.data.pubDate)}
                                    </span>
                                </a>
                            ))}
                        </>
                    ))
                }
                {
                    recentPosts.length === 0 && (
                        <div class="py-12 text-center">
                            <p class="text-flexoki-tx-2">
                                More stories coming soon
                            </p>
                        </div>
                    )
                }
            </div>
        </section>
        <section class="w-full">
            <SectionHeader title="Achievements" />
            <div class="space-y-0">
                {
                    achievementsData.map((item, index) => {
                        const prevYear =
                            index > 0 ? achievementsData[index - 1].year : null;
                        const showYear = item.year !== prevYear;
                        return (
                            <div class="group flex items-baseline gap-4 py-3 border-b border-flexoki-ui/50 hover:bg-flexoki-bg-2 transition-colors -mx-3 px-3">
                                <span class="text-flexoki-tx-3 tabular-nums w-12 shrink-0 text-sm">
                                    {showYear ? item.year : ""}
                                </span>
                                <span class="w-36 shrink-0 text-flexoki-tx font-medium text-sm">
                                    {item.achievement}
                                </span>
                                <span class="flex-1 text-sm">
                                    {item.eventUrl ? (
                                        <a
                                            href={item.eventUrl}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class="text-flexoki-tx-2 hover:text-flexoki-tx underline decoration-flexoki-ui/50 hover:decoration-flexoki-ui transition-colors"
                                        >
                                            {item.event}
                                        </a>
                                    ) : (
                                        <span class="text-flexoki-tx-2">
                                            {item.event}
                                        </span>
                                    )}
                                </span>
                                <span class="text-sm hidden sm:block shrink-0">
                                    {item.project && item.projectUrl ? (
                                        <a
                                            href={item.projectUrl}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class="text-flexoki-tx-3 hover:text-flexoki-tx underline decoration-flexoki-ui/50 hover:decoration-flexoki-ui transition-colors"
                                        >
                                            {item.project}
                                        </a>
                                    ) : item.project ? (
                                        <span class="text-flexoki-tx-3">
                                            {item.project}
                                        </span>
                                    ) : null}
                                </span>
                                <span class="shrink-0">
                                    {item.scope === "global" && (
                                        <GlobeIcon
                                            width={16}
                                            height={16}
                                            class="text-flexoki-tx-2"
                                        />
                                    )}
                                    {item.scope === "pe" && (
                                        <PeruFlag width={16} height={16} />
                                    )}
                                    {item.scope === "cl" && (
                                        <ChileFlag width={16} height={16} />
                                    )}
                                    {item.scope === "co" && (
                                        <ColombiaFlag width={16} height={16} />
                                    )}
                                </span>
                            </div>
                        );
                    })
                }
            </div>
        </section>
        <Footer />
    </PageLayout>
</Layout>
