---
import Layout from "../layouts/Layout.astro";
import ElementsLogo from "../components/brand/ElementsLogo.astro";
import TinteLogo from "../components/brand/TinteLogo.astro";
import OneHunterLogo from "../components/brand/OneHunterLogo.astro";
import ScrapiLogo from "../components/brand/ScrapiLogo.astro";
import AchievementCard from "../components/ui/AchievementCard.astro";
import HeroSection from "../components/layout/HeroSection.astro";
import SectionHeader from "../components/layout/SectionHeader.astro";
import PageLayout from "../components/layout/PageLayout.astro";
import Footer from "../components/layout/Footer.astro";
import { getCollection } from "astro:content";
import Text0Logo from "../assets/svgs/t0-logo.svg";
import Hack0Logo from "../assets/svgs/h0-logo.svg";

const allPosts = await getCollection("blog", ({ data }) => {
    return import.meta.env.PROD ? data.status !== "draft" : true;
});

const activePosts = allPosts
    .filter(({ data }) => data.status === "published")
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const recentPosts = activePosts.slice(0, 5);

const postsByYear = recentPosts.reduce(
    (acc, post) => {
        const year = post.data.pubDate.getFullYear();
        if (!acc[year]) acc[year] = [];
        acc[year].push(post);
        return acc;
    },
    {} as Record<number, typeof recentPosts>,
);

const years = Object.keys(postsByYear)
    .map(Number)
    .sort((a, b) => b - a);

const newestPost = activePosts[0];
const isNewest = (slug: string) => slug === newestPost?.slug;

const formatDate = (date: Date) => {
    const day = date.getDate().toString().padStart(2, "0");
    const month = (date.getMonth() + 1).toString().padStart(2, "0");
    return `${day}/${month}`;
};

// Data objects for all sections
const heroData = {
    name: "Railly Hugo",
    title: "Hunter",
};

const projectsData = [
    {
        title: "Elements",
        description: "Full-stack shadcn components",
        href: "https://tryelements.dev",
        icon: "elements" as IconKey,
    },
    {
        title: "text0",
        description: "AI-powered text editor",
        href: "https://text0.dev",
        icon: "text0" as IconKey,
    },
    {
        title: "Tinte",
        description: "Multiplatform theme builder",
        href: "https://tinte.dev",
        icon: "tinte" as IconKey,
    },
    {
        title: "One Hunter Theme",
        description: "VS Code theme (35k+ downloads)",
        href: "https://marketplace.visualstudio.com/items?itemName=RaillyHugo.one-hunter",
        icon: "oneHunter" as IconKey,
    },
    {
        title: "Scrapi",
        description: "Fast web scraper",
        href: "https://www.scrapi.fast",
        icon: "scrapi" as IconKey,
    },
    {
        title: "hack0",
        description: "LATAM tech ecosystem map",
        href: "https://hack0.dev",
        icon: "hack0" as IconKey,
    },
];

const achievementsData = [
    {
        title: "ğŸ† Overall Winner â€” First Ever Next.js Global Hackathon",
        year: "2025",
        color: "cyan" as const,
        embedId: "text0-embed",
        embedSrc: "https://www.youtube.com/embed/KDRwgbwq0_c?start=1142",
        embedType: "youtube" as const,
        project: "text0",
        hosts: ["vercel"],
        scope: "ğŸŒ",
    },
    {
        title: "ğŸ¥‡ 1st Place â€” Vercel AI Gateway Hackathon",
        year: "2025",
        color: "blue" as const,
        embedId: "ai-gateway-embed",
        embedSrc: "https://www.youtube.com/embed/yKzXoJgPenw?start=28889",
        embedType: "youtube" as const,
        project: "Chess Battle",
        hosts: ["vercel"],
        scope: "ğŸŒ",
    },
    {
        title: "ğŸ‘¨â€âš–ï¸ Judge & Mentor â€” IA Hackathon Colombia Tech Fest",
        year: "2025",
        color: "orange" as const,
        embedId: "colombia-judge-embed",
        embedSrc: "",
        embedType: "image" as const,
        project: "Colombia Tech Fest",
        imageUrl: "/images/colombia-hackathon.webp",
        linkedinUrl:
            "https://www.linkedin.com/posts/railly-hugo_de-vuelta-en-lima-despu%C3%A9s-de-una-experiencia-activity-7369217715481362432-XgLj",
        embedTitle:
            "ğŸ‡¨ğŸ‡´âœ¨ De vuelta en Lima despuÃ©s de una experiencia brutal en la <span class='font-bold'>IA Hackathon del Colombia Tech Fest</span>",
        scope: "ğŸ‡¨ğŸ‡´",
    },
    {
        title: "ğŸ“ Outstanding Engineering Graduate â€” UNMSM",
        year: "2025",
        color: "purple" as const,
        embedId: "unmsm-egresado-embed",
        embedSrc: "https://www.youtube.com/embed/swdmucdGGLA?start=10362",
        embedType: "youtube" as const,
        hosts: ["unmsm"],
        scope: "ğŸ‡µğŸ‡ª",
    },
    {
        title: "ğŸ–ï¸ Finalist â€” Platanus Hack 25'",
        year: "2025",
        color: "teal" as const,
        embedId: "scrapi-platanus-embed",
        embedSrc: "",
        embedType: "image" as const,
        project: "Scrapi",
        imageUrl: "/images/platanus-hack.webp",
        linkedinUrl:
            "https://www.linkedin.com/posts/railly-hugo_gran-experiencia-en-la-platanus-hack-25-activity-7400005671913684992-A1WW",
        embedTitle:
            "ğŸ‡¨ğŸ‡±âš¡ Gran experiencia en la <span class='font-bold'>Platanus Hack 25' ft. Buk</span> en Chile. Llegamos a la final con Scrapi.",
        scope: "ğŸ‡¨ğŸ‡±",
    },
    {
        title: "ğŸ–ï¸ Finalist â€” IA Hackathon LATAM",
        year: "2025",
        color: "yellow" as const,
        embedId: "githunter-embed",
        embedSrc:
            "https://www.linkedin.com/embed/feed/update/urn:li:ugcPost:7328521111485243393?compact=1",
        embedType: "linkedin" as const,
        project: "GitHunter",
        scope: "ğŸŒ",
    },
    {
        title: "ğŸ¥‰ 3rd Place â€” Vercel Ã— Midudev Hackathon",
        year: "2024",
        color: "magenta" as const,
        embedId: "tinte-embed",
        embedSrc:
            "https://www.linkedin.com/embed/feed/update/urn:li:ugcPost:7232743944592240640?compact=1",
        embedType: "linkedin" as const,
        project: "Tinte",
        hosts: ["vercel", "midudev"],
        scope: "ğŸŒ",
    },
];

// Icon mapping for components
const iconMap = {
    elements: ElementsLogo,
    text0: Text0Logo,
    tinte: TinteLogo,
    oneHunter: OneHunterLogo,
    scrapi: ScrapiLogo,
    hack0: Hack0Logo,
} as const;

type IconKey = keyof typeof iconMap;
---

<Layout>
    <PageLayout class="flex flex-col gap-10">
        <HeroSection name={heroData.name} title={heroData.title} />

        <section class="w-full">
            <SectionHeader title="Projects" />
            <div class="space-y-0">
                {
                    projectsData.map((project) => {
                        const IconComponent =
                            project.icon && project.icon in iconMap
                                ? iconMap[project.icon as IconKey]
                                : null;
                        return (
                            <a
                                href={project.href}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="group flex items-center gap-4 py-3 border-b border-flexoki-ui hover:bg-flexoki-bg-2 transition-colors -mx-3 px-3"
                            >
                                <span class="w-6 h-6 flex items-center justify-center shrink-0">
                                    {IconComponent && (
                                        <IconComponent
                                            width={20}
                                            height={20}
                                            class="text-flexoki-tx"
                                        />
                                    )}
                                </span>
                                <span class="flex-1 text-flexoki-tx font-medium">
                                    {project.title}
                                </span>
                                <span class="text-flexoki-tx-3 text-sm hidden sm:block">
                                    {project.description}
                                </span>
                                <svg
                                    width="14"
                                    height="14"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.5"
                                    viewBox="0 0 24 24"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="text-flexoki-tx-3 group-hover:translate-x-0.5 transition-transform shrink-0"
                                >
                                    <path d="M4.5 12h15m0 0-5.625-6m5.625 6-5.625 6" />
                                </svg>
                            </a>
                        );
                    })
                }
            </div>
        </section>
        <section class="w-full">
            <div class="flex items-center justify-between mb-4">
                <SectionHeader title="Writing" className="mb-0" />
                <a
                    href="/writing"
                    class="group text-xs text-flexoki-tx-3 hover:text-flexoki-tx-2 transition-colors duration-200"
                >
                    <span class="flex items-center gap-1">
                        <span>view all</span>
                        <svg
                            width="10"
                            height="10"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="1.5"
                            viewBox="0 0 24 24"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path d="M4.5 12h15m0 0-5.625-6m5.625 6-5.625 6"
                            ></path>
                        </svg>
                    </span>
                </a>
            </div>
            <div class="space-y-0">
                {
                    years.map((year) => (
                        <>
                            {postsByYear[year].map((post, index) => (
                                <a
                                    href={`/blog/${post.slug}`}
                                    class="group flex items-baseline gap-4 py-3 border-b border-flexoki-ui hover:bg-flexoki-bg-2 transition-colors -mx-3 px-3"
                                >
                                    <span class="text-flexoki-tx-3 tabular-nums w-12 shrink-0 text-sm">
                                        {index === 0 ? year : ""}
                                    </span>
                                    <span class="flex-1 text-flexoki-tx group-hover:text-flexoki-tx font-medium">
                                        {post.data.title}
                                        {isNewest(post.slug) && (
                                            <span class="ml-2 text-xs font-normal px-1.5 py-0.5 bg-flexoki-ui rounded text-flexoki-tx-2">
                                                Newest
                                            </span>
                                        )}
                                    </span>
                                    <span class="text-flexoki-tx-3 tabular-nums text-sm shrink-0">
                                        {formatDate(post.data.pubDate)}
                                    </span>
                                </a>
                            ))}
                        </>
                    ))
                }
                {
                    recentPosts.length === 0 && (
                        <div class="py-12 text-center">
                            <p class="text-flexoki-tx-2">More stories coming soon</p>
                        </div>
                    )
                }
            </div>
        </section>
        <section class="flex flex-col gap-4 w-full">
            <SectionHeader title="Achievements" />
            <div class="flex flex-col gap-4">
                {
                    achievementsData.map((achievement) => (
                        <AchievementCard
                            title={achievement.title}
                            year={achievement.year}
                            color={achievement.color}
                            embedId={achievement.embedId}
                            embedSrc={achievement.embedSrc}
                            embedType={achievement.embedType}
                            project={achievement.project}
                            hosts={achievement.hosts}
                            linkedinUrl={achievement.linkedinUrl}
                            imageUrl={achievement.imageUrl}
                            embedDescription={achievement.embedDescription}
                            embedTitle={achievement.embedTitle}
                            scope={achievement.scope}
                        />
                    ))
                }
            </div>
        </section>
        <Footer />
    </PageLayout>
</Layout>
