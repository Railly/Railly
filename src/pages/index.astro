---
import Layout from "../layouts/Layout.astro";
import ElementsLogo from "../components/brand/ElementsLogo.astro";
import TinteLogo from "../components/brand/TinteLogo.astro";
import OneHunterLogo from "../components/brand/OneHunterLogo.astro";
import ScrapiLogo from "../components/brand/ScrapiLogo.astro";
import HeroSection from "../components/layout/HeroSection.astro";
import SectionHeader from "../components/layout/SectionHeader.astro";
import PageLayout from "../components/layout/PageLayout.astro";
import Footer from "../components/layout/Footer.astro";
import { getCollection } from "astro:content";
import Text0Logo from "../assets/svgs/t0-logo.svg";
import Hack0Logo from "../assets/svgs/h0-logo.svg";

const allPosts = await getCollection("blog", ({ data }) => {
    return import.meta.env.PROD ? data.status !== "draft" : true;
});

const activePosts = allPosts
    .filter(({ data }) => data.status === "published")
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const recentPosts = activePosts.slice(0, 5);

const postsByYear = recentPosts.reduce(
    (acc, post) => {
        const year = post.data.pubDate.getFullYear();
        if (!acc[year]) acc[year] = [];
        acc[year].push(post);
        return acc;
    },
    {} as Record<number, typeof recentPosts>,
);

const years = Object.keys(postsByYear)
    .map(Number)
    .sort((a, b) => b - a);

const newestPost = activePosts[0];
const isNewest = (slug: string) => slug === newestPost?.slug;

const formatDate = (date: Date) => {
    const day = date.getDate().toString().padStart(2, "0");
    const month = (date.getMonth() + 1).toString().padStart(2, "0");
    return `${day}/${month}`;
};

// Data objects for all sections
const heroData = {
    name: "Railly Hugo",
    title: "Hunter",
};

const projectsData = [
    {
        title: "Elements",
        description: "Full-stack shadcn components",
        href: "https://tryelements.dev",
        icon: "elements" as IconKey,
    },
    {
        title: "text0",
        description: "AI-powered text editor",
        href: "https://text0.dev",
        icon: "text0" as IconKey,
    },
    {
        title: "Tinte",
        description: "Multiplatform theme builder",
        href: "https://tinte.dev",
        icon: "tinte" as IconKey,
    },
    {
        title: "One Hunter Theme",
        description: "VS Code theme (35k+ downloads)",
        href: "https://marketplace.visualstudio.com/items?itemName=RaillyHugo.one-hunter",
        icon: "oneHunter" as IconKey,
    },
    {
        title: "Scrapi",
        description: "Fast web scraper",
        href: "https://www.scrapi.fast",
        icon: "scrapi" as IconKey,
    },
    {
        title: "hack0",
        description: "LATAM tech ecosystem map",
        href: "https://hack0.dev",
        icon: "hack0" as IconKey,
    },
];

const achievementsData = [
    { year: "2025", achievement: "Overall Winner", event: "Next.js Global Hackathon", project: "text0" },
    { year: "2025", achievement: "1st Place", event: "Vercel AI Gateway Hackathon", project: "Chess Battle" },
    { year: "2025", achievement: "Judge & Mentor", event: "IA Hackathon Colombia Tech Fest" },
    { year: "2025", achievement: "Outstanding Graduate", event: "UNMSM Engineering" },
    { year: "2025", achievement: "Finalist", event: "Platanus Hack 25'", project: "Scrapi" },
    { year: "2025", achievement: "Finalist", event: "IA Hackathon LATAM", project: "GitHunter" },
    { year: "2024", achievement: "3rd Place", event: "Vercel × Midudev Hackathon", project: "Tinte" },
];

// Icon mapping for components
const iconMap = {
    elements: ElementsLogo,
    text0: Text0Logo,
    tinte: TinteLogo,
    oneHunter: OneHunterLogo,
    scrapi: ScrapiLogo,
    hack0: Hack0Logo,
} as const;

type IconKey = keyof typeof iconMap;
---

<Layout>
    <PageLayout class="flex flex-col gap-10">
        <HeroSection name={heroData.name} title={heroData.title} />

        <section class="w-full">
            <SectionHeader title="Projects" />
            <div class="space-y-0">
                {
                    projectsData.map((project) => {
                        const IconComponent =
                            project.icon && project.icon in iconMap
                                ? iconMap[project.icon as IconKey]
                                : null;
                        return (
                            <a
                                href={project.href}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="group flex items-center gap-4 py-3 border-b border-flexoki-ui hover:bg-flexoki-bg-2 transition-colors -mx-3 px-3"
                            >
                                <span class="w-6 h-6 flex items-center justify-center shrink-0">
                                    {IconComponent && (
                                        <IconComponent
                                            width={20}
                                            height={20}
                                            class="text-flexoki-tx"
                                        />
                                    )}
                                </span>
                                <span class="flex-1 text-flexoki-tx font-medium">
                                    {project.title}
                                </span>
                                <span class="text-flexoki-tx-3 text-sm hidden sm:block">
                                    {project.description}
                                </span>
                                <svg
                                    width="14"
                                    height="14"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.5"
                                    viewBox="0 0 24 24"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="text-flexoki-tx-3 group-hover:translate-x-0.5 transition-transform shrink-0"
                                >
                                    <path d="M4.5 12h15m0 0-5.625-6m5.625 6-5.625 6" />
                                </svg>
                            </a>
                        );
                    })
                }
            </div>
        </section>
        <section class="w-full">
            <div class="flex items-center justify-between mb-4">
                <SectionHeader title="Writing" className="mb-0" />
                <a
                    href="/writing"
                    class="group text-xs text-flexoki-tx-3 hover:text-flexoki-tx-2 transition-colors duration-200"
                >
                    <span class="flex items-center gap-1">
                        <span>view all</span>
                        <svg
                            width="10"
                            height="10"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="1.5"
                            viewBox="0 0 24 24"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path d="M4.5 12h15m0 0-5.625-6m5.625 6-5.625 6"
                            ></path>
                        </svg>
                    </span>
                </a>
            </div>
            <div class="space-y-0">
                {
                    years.map((year) => (
                        <>
                            {postsByYear[year].map((post, index) => (
                                <a
                                    href={`/blog/${post.slug}`}
                                    class="group flex items-baseline gap-4 py-3 border-b border-flexoki-ui hover:bg-flexoki-bg-2 transition-colors -mx-3 px-3"
                                >
                                    <span class="text-flexoki-tx-3 tabular-nums w-12 shrink-0 text-sm">
                                        {index === 0 ? year : ""}
                                    </span>
                                    <span class="flex-1 text-flexoki-tx group-hover:text-flexoki-tx font-medium">
                                        {post.data.title}
                                        {isNewest(post.slug) && (
                                            <span class="ml-2 text-xs font-normal px-1.5 py-0.5 bg-flexoki-ui rounded text-flexoki-tx-2">
                                                Newest
                                            </span>
                                        )}
                                    </span>
                                    <span class="text-flexoki-tx-3 tabular-nums text-sm shrink-0">
                                        {formatDate(post.data.pubDate)}
                                    </span>
                                </a>
                            ))}
                        </>
                    ))
                }
                {
                    recentPosts.length === 0 && (
                        <div class="py-12 text-center">
                            <p class="text-flexoki-tx-2">More stories coming soon</p>
                        </div>
                    )
                }
            </div>
        </section>
        <section class="w-full">
            <SectionHeader title="Achievements" />
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-flexoki-ui text-left">
                            <th class="py-2 pr-4 font-medium text-flexoki-tx-2 w-16">Year</th>
                            <th class="py-2 pr-4 font-medium text-flexoki-tx-2">Achievement</th>
                            <th class="py-2 pr-4 font-medium text-flexoki-tx-2 hidden sm:table-cell">Event</th>
                            <th class="py-2 font-medium text-flexoki-tx-2 hidden md:table-cell">Project</th>
                        </tr>
                    </thead>
                    <tbody>
                        {achievementsData.map((item) => (
                            <tr class="border-b border-flexoki-ui/50 hover:bg-flexoki-bg-2 transition-colors">
                                <td class="py-3 pr-4 text-flexoki-tx-3 tabular-nums">{item.year}</td>
                                <td class="py-3 pr-4 text-flexoki-tx font-medium">{item.achievement}</td>
                                <td class="py-3 pr-4 text-flexoki-tx-2 hidden sm:table-cell">{item.event}</td>
                                <td class="py-3 text-flexoki-tx-3 hidden md:table-cell">{item.project || "—"}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        </section>
        <Footer />
    </PageLayout>
</Layout>
